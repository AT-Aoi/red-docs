= 视觉界面方言
:imagesdir: ../images
:toc:
:toclevels: 3
:toc-title: 目录
:numbered:

== 概述

VID 一词代表可视界面方言，其目的是提供一种用于在 Red link:view.adoc[View] 引擎之上描述图形用户界面的简单的方言（DSL）。

VID 允许你指定要显示的每个图形组件，还给与你不同选择的布局方法：

* 水平或垂直流布局
* 网格定位
* 绝对定位

VID 将自动为你创建一个容器元件以持有你提供的元件描述。默认情况下，容器元件的类型为 `window`。

VID 代码由 `layout` 函数处理（`view` 函数内部调用就是它），然后被编译成一棵适合用来显示的内含元件的树。

[NOTE, caption=注意]
====
在 Red 的控制台使用 `help view` 和 `help layout` 看看如何处理 VID 区块。
====

== 代码结构

典型的 VID 代码区块具有以下结构：

[source, red]
    [
        <容器设定>
        <布局描述>
    ]

* **容器设定**：影响容器对象（可以是面板或窗口）的设定。

* **布局描述**：布局定位命令、样式定义和元件描述。

[NOTE, caption=注意]
====
所有部分都是可选的，没有必须要在 VID 区块中提供的强制性的内容。
====

== 容器设定

[NOTE, caption=注意]
====
在元件选项级别之外，`react` 关键字也可以在容器设定级别使用，参照它<< anchor:_react, 那里>>的描述。
====

=== `title`

*语法*

[source, red]
----
title <text>

<text> : 标题文本 (string!)。
----

*描述*

设置该容器元件的标题文本。

=== `size`

*语法*

[source, red]
----
size <value>

<value> : 宽高，以像素为单位 (pair!)。
----

*描述*

设置该容器元件的大小。如果没有显式地提供大小，则会自动计算该容器的大小以适应其内容。

=== `backdrop`

*语法*

[source, red]
----
backdrop <color>

<color> : 颜色的名字或值 (word! tuple! issue!)。
----

*描述*

设置该容器元件的背景颜色。

=== 动作器定义

容器的动作器也可以定义在该代码区域，要定义动作器请参考 <<Actors>> 小节。

== 布局

默认情况下，VID 根据简单的规则将元件放置在容器元件中：

* 方向可以为水平或垂直
* 一个元件按当前的方向以当前的间隔被放置在另一个元件之后

默认：

* 原点（origin）：`10x10`
* 间距（space）：`10x10`
* 方向（direction）：`across`
* 对齐（alignment）：`top`

这是在 `across` 模式中布置元件的方式：

image::across.png[across,align="center"]

这是在 `below` 模式中布置元件的方式（使用默认的 `left` 对齐方式）：

image::below.png[below,align="center"]

=== `across`

*语法*

[source, red]
----
across <alignment>

<alignment> : （可选）可以取的值：top | middle | bottom。
----

*描述*

将布局方向设置为水平，从左到右。可选提供对齐修饰符来更改行中默认（`top`）的元件对齐方式。

=== `below`

*语法*

[source, red]
----
below <alignment>

<alignment> : （可选）可以取的值：left | center | right。
----

*描述*

将布局方向设置为垂直，从上到下。可选提供对齐修饰符来更改列中默认（`left`）的元件对齐方式。

=== `return`

*语法*

[source, red]
----
return <alignment>

<alignment> : （可选）可以取的值：left | center | right | top | middle | bottom。
---- 

*描述*

根据当前布局方向将位置移动到元件的下一行或下一列。可选提供对齐修饰符来更改行中或列中元件当前的对齐方式。

=== `space`

*语法*

[source, red]
----
space <offset>

<offset> : 新的间距值 (pair!)。
----

*描述*

设置将用于放置在它之后的元件的新的间距偏移。

=== `origin`

*语法*

[source, red]
----
origin <offset>

<offset> : 新原点的值 (pair!)。
----

*描述*

设置相对于容器元件的新的原点的位置。

=== `at`

*语法*

[source, red]
----
at <offset>

<offset> : 下一个元件的位置 (pair!)。
----

*描述*

将下一个元件放在绝对位置。该定位模式仅影响下一个元件，并不会更改布局流位置。所以，在下一个元件之后的元件将再次在布局流中跟着之前的元件被放置。

=== `pad`

*语法*

[source, red]
----
pad <offset>

<offset> : 相对偏移量 (pair!)。
----
*描述*

以一个相对偏移量修改布局的当前位置，所有在同一行（或列）中的后续元件都会受到影响。

=== `do`

*语法*

[source, red]
----
do <body>

<body> : 要求值的代码 (block!)。
----

*描述*

对内含常规 Red 代码的区块进行求值，这是用于满足在最后做初始化的需要。`body` 区块绑定在容器元件（窗口或面板）上，所以可以直接访问容器的特征。可以使用 `self` 关键字引用到容器元件。

== 附加样式

视图引擎提供了许多内建部件，VID 方言通过关联的关键字来附加地定义常用的样式以扩展它们。它们可以使用跟其底层元件类型一样的选项，也可以自由地通过 `style` 命令重新定义样式。
	
=== `h1`

`h1` 样式是字体大小设置为 32 的 `text` 类型。

=== `h2`

`h2` 样式是字体大小设置为 26 的 `text` 类型。

=== `h3`

`h3` 样式是字体大小设置为 22 的 `text` 类型。

=== `h4`

`h4` 样式是字体大小设置为 17 的 `text` 类型。

=== `h5`

`h5` 样式是字体大小设置为 13 的 `text` 类型。

=== `box`

`box` 样式是带有默认的透明颜色的 `base` 类型。

=== `image`

`image` 样式是默认大小为 `100x100` 的 `base` 类型。它期望被提供一个 `image!` 选项，如果没有的话，就会提供一个背景颜色为白色的、与元件大小相同的空图像。

== 元件定义

可以通过使用现有face类型或可用样式之一的名称，将布局中的face插入当前位置。

*语法*

[source, red]
----
<name>: <type> <options>

<name>    : （可选）新组件的名称 (set-word!)。
<type>    : 有效的元件类型或样式名称 (word!)。
<options> : （可选）选项列表。
----

如果提供了 `name`，该单词将引用 VID 从元件描述中创建的 `face!` 对象。

每个元件类型或样式都有提供默认值，因此无需指定任何选项就可以使用一个新的元件。当需要选项时，以下小节将描述可接收的不同类型的选项：

* 关键字
* 数据类型
* 动作器

所有选项都可以以任意顺序指定，跟在元件或样式名称之后。一个新的元件名称或布局关键字标记了给定元件的选项列表的结尾。

[NOTE, caption=注意]
====
`window` 不能被用作元件类型。
====

=== Keywords 

==== left

*语法*
----
left
---- 
*描述*

将face的文字对准左侧。


==== center

*语法*
----
center
----
*描述*

居中对齐face的文字。


==== right

*语法*
----
right
----
*描述*

将face的文字对准右侧。


==== top

*语法*
----
top
----
*描述*

将face的文字垂直对齐为`top`。


==== middle

*语法*
----
middle
----
*描述*

将face的文字垂直对齐为`middle`。


==== bottom

*语法*
----
bottom
----
*描述*

将face的文字垂直对齐为`bottom`。


==== bold

*语法*
----
bold
----
*描述*

将face的文字样式设置为`bold`。


==== italic

*语法*
----
italic
----
*描述*

将face的文字样式设置为`italic`。


==== underline

*语法*
----
underline
----
*描述*

将face的文字样式设置为`underline`。


==== extra

*语法*
----
extra <value>

<value> : any value (any-type!).
----
*描述*

将face的`extra` facet设置为新值。


==== data

*语法*
----
data <list>

<list> : list of items (block!).
----
*描述*

将face的`data` facet设置为值列表。 列表的格式取决于face类型要求。


==== draw

*语法*
----
draw <commands>

<commands> : list commands (block!).
---- 
*描述*

将face的`draw` facet设置为Draw方言命令列表。 有关有效命令，请参阅[Draw方言](draw.html)文档。


==== font

*语法*
----
font <spec>

<spec> : a valid font specification (block! object! word!).
----
*描述*

将face的`font` facet设置为新的`font!`对象。font!对象被描述为 link:view.html＃_font_object [这里]。

注意：可以使用`font`与其他字体相关的设置，VID将它们合并在一起，优先于指定的最后一个。


==== para

*语法*
----
para <spec>

<spec> : a valid para specification (block! object! word!).
----
*描述*

将face的`para` facet设置为新的`para!`对象。para!对象被描述 link:view.html＃_para_object [对象]。

注意：可以使用`para`以及其他与`para`相关的设置，VID将它们合并在一起，优先于指定的最后一个。

==== wrap

*语法*
----
wrap
----

*描述*

在显示时包裹face的文字。


==== no-wrap

*语法*
----
no-wrap
----
*描述*

避免在显示时包裹face的文字。


==== font-size

*语法*
----
font-size <pt>

<pt> : font size in points (integer! word!).
----
*描述*

设置face文字的当前字体大小。


==== font-color

*语法*
----
font-color <value>

<value> : color of the font (tuple! word! issue!).
----
*描述*

设置face文字的当前字体颜色。


==== font-name

*语法*
----
font-name <name>

<name> : valid name of an available font (string! word!).
----
*描述*

设置face文字的当前字体名。


==== react

此关键字既可用作face选项，也可用作全局关键字。可以使用任意数量的`react`实例。

*语法*
----
react [<body>]
react later [<body>]

<body> : regular Red code (block!).
----
*描述*

从body块创建一个新的reactor。 当`react`用作face选项时，body可以使用`face`字来引用当前face。 当全局使用`react`时，需要使用名称访问目标face。可选的`later`关键字跳过在`body`块被处理之后立即发生的第一个反应。

注意：

reactor是View中的响应式编程支持的一部分，文档正在编写。 简而言之，body块可以使用路径来描述face属性之间的一个或多个关系。 设置路径设置face属性被处理为reactor的* target*（要更新的face），而访问face属性的路径被处理为reactor的*source*（源的更改触发了reactor的更新码）。

==== loose

*语法*
----
loose
----
*描述*

启用使用鼠标左键拖动face。


==== all-over

*语法*
----
all-over
----
*描述*

设置face `all-over`标志，允许接收所有鼠标`over`事件。


==== hidden

*语法*
----
hidden
----
*描述*

默认情况下使face看不见。


==== disabled

*语法*
----
disabled
----
*描述*

默认情况下禁用face（face不会处理任何事件，直到启用）。


==== select

*语法*
----
select <index>

<index> : index of selected item (integer!).
----
*描述*

设置当前face的`selected` facet。 主要用于列表以指示预先选择的项目。


==== focus

*语法*
----
focus
---- 
*描述*

当窗口首次显示时，将焦点放在当前的face。 只有一个face可以有焦点。 如果在不同的face上使用了几个`focus`选项，只有最后一个可以获得焦点。

==== hint

*语法*
----
hint <message>

<message> : hint text (string!).
---- 
*描述*

当字段的内容为空时，在`field` face中提供一个提示消息。 当提供任何新内容时，该文本消失（用户操作或设置`face/text` facet）。


==== rate

*语法*
----
rate <value>
rate <value> now

<value>: duration or frequency (integer! time!).
----
*描述*

从持续时间（time!）或频率（integer!）设置face的定时器。 在每个定时器的刻度上，将为该face产生一个`time`事件。 如果使用`now`选项，则会立即生成第一次事件。


==== default

*语法*
----
default <value>

<value>: a default value for `data` facet (any-type!).
----
*描述*

当`text` facet的转换返回`none`时，定义`data` facet的默认值。 该默认值存储在`options` facet中，作为key/value对。

注意：目前仅使用`text`和`field` face类型。


=== Datatypes 

除了关键字，允许使用以下类型的文字值将设置传递给face：

[cols="1,3", options="header"]
|===
|Datatype|	Purpose
|integer!|	Specifies the width of the face. For panels, indicates the number of row or columns for the layout, depending on the current direction.
|pair!|		Specifies the width and height of the face.
|tuple!|	Specifies the color of the face's background (where applicable).
|issue!|	Specifies the color of the face's background using hex notation (#rgb, #rrggbb, #rrggbbaa).
|string!|	Specifies the text to be displayed by the face.
|percent!|	Sets the `data` facet (useful for `progress` and `slider` types).
|logic!|	Sets the `data` facet (useful for `check` and `radio` types).
|image!| 	Sets the image to be displayed as face's background (where applicable).
|url!| 		Loads the resource pointed to by the URL, then process the resource according to its loaded type.
|block!|	Sets the action for the default event of the face. For panels, specifies their content.
|get-word!| Uses an existing function as actor.
|char!| _(reserved for future use)_.
|===

=== Actors 

actor可以通过指定一个文字块值或一个actor名称后跟一个块值来挂接到face。

*语法*
----
<actor>
on-<event> <actor>

<actor> : actor's body block or actor reference (block! get-word!).
<event> : valid event name (word!). 
----
*描述*

可以通过仅仅提供actor的body块来指定actor，这个spec块是隐式的。 actor功能被构造，然后添加到face的`actor` facet。 几个actor可以这样指定。

创建的actor功能完整规范是：
----
func [face [object!] event [event! none!]][...body...]
----
可以在 link:view.html＃_actors[这里] 找到有效的事件名称列表。

当一个块或一个get-word没有任何actor名称前缀被传递时，face类型的默认actor是根据 https://github.com/red/red/blob/master/modules/view/styles.red[这里] 定义创建的。


== Panels 

可以定义子面板以将face部分组在一起，并最终应用特定样式。 新面板的大小（如果未明确指定）将自动计算，以适应其内容。

VID中使用特定语法支持来自View的面板类face类型：

=== panel 

*语法*
----
panel <options> [<content>]

<options> : optional list of settings for the panel.
<content> : panel's VID content description (block!).
----
*描述*

在当前容器内构造一个子面板，其中内容是另一个VID块。 除了其他的face选项之外，还可以提供整数除数器选项，设置网格模式布局：

* 如果方向是across，则分隔符表示列数。
* 如果方向是below，则分隔符表示行数。


=== group-box 

*语法*
----
group-box <divider> <options> [<body>]

<divider> : optional number of row or columns (integer!).
<options> : optional list of settings for the panel.
<body>    : panel's VID content description (block!).
----
*描述*

在当前容器中构造一个子组合框面板，其中内容是另一个VID块。 可以提供一个分频器参数，设置网格模式布局：

* 如果方向是across，则分隔符表示列数。
* 如果方向是below，则分隔符表示行数。

注意：提供一个`string!`值作为选项将设置组框标题文本。


=== tab-panel 

*语法*
----
tab-panel <options> [<name> <body>...]

<options> : optional list of settings for the panel.
<name>    : a tab's title (string!).
<body>    : a tab's content as VID description (block!).
----
*描述*

在当前容器内构建一个制表符面板面板。 规范块必须包含每个选项卡的一对名称和内容描述。 每个标签的内容正文都是一个新的子面板，充当任何其他面板。


== Styling 

=== style 

*语法*
----
style <new> <old> <options>

<new>     : name of new style (set-word!).
<old>     : name of old style (word!).
<options> : optional list of settings for the new style.
----
*描述*

在当前面板中设置新样式。 可以从现有的face类型或其他样式创建新的样式。 新风格仅在当前面板和子面板中有效。

样式可以从父面板级联到子面板，以便可以在子面板中重新定义或扩展相同的样式名称，而不会影响父面板中的定义。
